import{d as f,a as w,g as V,u,s as n,i as y,b as I,c as v,e as R}from"./index-aeadb3cd.js";const s={NONE:0,VIP1:1,VIP2:2},g={[s.VIP1]:5,[s.VIP2]:20},p={[s.VIP1]:{weekly:50,monthly:0},[s.VIP2]:{weekly:50,monthly:2e3}},k=a=>a>=g[s.VIP2]?s.VIP2:a>=g[s.VIP1]?s.VIP1:s.NONE,T=a=>{switch(a){case s.VIP1:return"VIP 1";case s.VIP2:return"VIP 2";default:return"Regular"}},N=async a=>{try{const r=f(w,"users",a),t=await V(r);if(!t.exists())throw new Error("User not found");const i=t.data(),l=i.totalReferrals||0,o=i.vipLevel||s.NONE,e=k(l);return e!==o?(await u(r,{vipLevel:e,vipLevelUpdatedAt:n(),updatedAt:n()}),{success:!0,oldLevel:o,newLevel:e,referralCount:l}):{success:!0,oldLevel:o,newLevel:e,referralCount:l,changed:!1}}catch(r){throw console.error("Error updating VIP level:",r),r}},L=async a=>{var r;try{const t=f(w,"users",a),i=await V(t);if(!i.exists())throw new Error("User not found");const l=i.data(),o=l.vipLevel||s.NONE;if(o===s.NONE)return{success:!1,message:"User is not a VIP member"};const e=((r=p[o])==null?void 0:r.weekly)||0;if(e<=0)return{success:!1,message:"No weekly reward for this VIP level"};const c=l.lastWeeklyReward,m=new Date,P=new Date(m.getTime()-7*24*60*60*1e3);if(c){const h=c.toMillis?new Date(c.toMillis()):new Date(c);if(h>P)return{success:!1,message:`Weekly reward already received. Next reward in ${Math.ceil((h.getTime()+6048e5-m.getTime())/864e5)} days.`,alreadyReceived:!0}}const d=f(w,"wallets",a);return(await V(d)).exists()?await u(d,{balanceWallet:y(e),totalEarnings:y(e),incomeToday:y(e),updatedAt:n()}):await u(d,{userId:a,rechargeWallet:0,balanceWallet:e,totalEarnings:e,totalWithdrawals:0,incomeToday:e,incomeYesterday:0,lossToday:0,lossTotal:0,updatedAt:n()}),await u(t,{lastWeeklyReward:n(),updatedAt:n()}),await I(v(w,"transactions"),{userId:a,type:"vip_weekly_reward",amount:e,status:"completed",vipLevel:o,description:`VIP ${o} Weekly Reward`,transactionId:"VIP_WEEKLY_"+Date.now(),createdAt:n()}),{success:!0,amount:e,vipLevel:o,message:`Weekly VIP reward of ${e} added to balance`}}catch(t){throw console.error("Error distributing weekly VIP reward:",t),t}},W=async a=>{var r;try{const t=f(w,"users",a),i=await V(t);if(!i.exists())throw new Error("User not found");const l=i.data(),o=l.vipLevel||s.NONE;if(o!==s.VIP2)return{success:!1,message:"Monthly rewards are only for VIP 2 members"};const e=((r=p[s.VIP2])==null?void 0:r.monthly)||0;if(e<=0)return{success:!1,message:"No monthly reward configured"};const c=l.lastMonthlyReward,m=new Date,P=new Date(m.getTime()-30*24*60*60*1e3);if(c){const h=c.toMillis?new Date(c.toMillis()):new Date(c);if(h>P)return{success:!1,message:`Monthly reward already received. Next reward in ${Math.ceil((h.getTime()+2592e6-m.getTime())/864e5)} days.`,alreadyReceived:!0}}const d=f(w,"wallets",a);return(await V(d)).exists()?await u(d,{balanceWallet:y(e),totalEarnings:y(e),incomeToday:y(e),updatedAt:n()}):await R(d,{userId:a,rechargeWallet:0,balanceWallet:e,totalEarnings:e,totalWithdrawals:0,incomeToday:e,incomeYesterday:0,lossToday:0,lossTotal:0,updatedAt:n()}),await u(t,{lastMonthlyReward:n(),updatedAt:n()}),await I(v(w,"transactions"),{userId:a,type:"vip_monthly_reward",amount:e,status:"completed",vipLevel:o,description:`VIP ${o} Monthly Reward`,transactionId:"VIP_MONTHLY_"+Date.now(),createdAt:n()}),{success:!0,amount:e,vipLevel:o,message:`Monthly VIP reward of ${e} added to balance`}}catch(t){throw console.error("Error distributing monthly VIP reward:",t),t}},A=async a=>{try{try{await N(a)}catch(t){console.error("Error syncing VIP level before reward distribution:",t)}const r={weekly:null,monthly:null};try{r.weekly=await L(a)}catch(t){console.error("Error checking weekly reward:",t),r.weekly={success:!1,error:t.message}}try{r.monthly=await W(a)}catch(t){console.error("Error checking monthly reward:",t),r.monthly={success:!1,error:t.message}}return r}catch(r){throw console.error("Error checking VIP rewards:",r),r}};export{s as VIP_LEVELS,p as VIP_REWARDS,g as VIP_THRESHOLDS,k as calculateVIPLevel,A as checkAndDistributeVIPRewards,W as distributeMonthlyVIPReward,L as distributeWeeklyVIPReward,T as getVIPLevelName,N as updateVIPLevel};
